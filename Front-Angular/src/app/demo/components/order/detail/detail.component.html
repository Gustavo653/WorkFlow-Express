<p-progressBar [hidden]="!loading" mode="indeterminate" [style]="{ height: '3px' }"></p-progressBar>
<div *ngIf="!loading">
    <div class="card">
        <button pButton icon="pi pi-refresh" label="Retornar" class="p-button" onclick="window.history.back(); return false;"></button>
        <h3>Detalhes do chamado {{ data.id }}</h3>
        <div class="grid">
            <div class="col-12 md:col-6 lg:col-3">
                <h5>Parâmetros</h5>
                <div [class]="style.formCard">
                    <span [class]="style.formItem" class="p-float-label">
                        <input [class]="style.formItem" pInputText [(ngModel)]="data.title" />
                        <label>Título</label>
                    </span>
                    <span [class]="style.formItem" class="p-float-label">
                        <p-dropdown
                            [filter]="true"
                            placeholder="Selecione um valor"
                            filterBy="name"
                            optionValue="id"
                            [class]="style.formItem"
                            optionLabel="name"
                            [options]="priorities"
                            [(ngModel)]="data.priorityId"
                        ></p-dropdown>
                        <label>Prioridade</label>
                    </span>
                    <span [class]="style.formItem" class="p-float-label">
                        <p-dropdown
                            [class]="style.formItem"
                            [filter]="true"
                            placeholder="Selecione um valor"
                            filterBy="name"
                            optionValue="id"
                            optionLabel="name"
                            [readonly]="true"
                            [options]="statuses"
                            [(ngModel)]="data.statusId"
                        ></p-dropdown>
                        <label>Status</label>
                    </span>
                    <span [class]="style.formItem" class="p-float-label">
                        <p-dropdown
                            [class]="style.formItem"
                            [filter]="true"
                            placeholder="Selecione um valor"
                            filterBy="name"
                            optionValue="id"
                            optionLabel="name"
                            [options]="categories"
                            [(ngModel)]="data.categoryId"
                        ></p-dropdown>
                        <label>Categoria</label>
                    </span>
                    <p-selectButton [class]="style.formItem" [options]="agentSelector" [(ngModel)]="agentValue" optionLabel="label" optionValue="value"></p-selectButton>

                    <span [class]="style.formItem" *ngIf="agentValue == 'agent'" class="p-float-label">
                        <p-dropdown
                            [class]="style.formItem"
                            [filter]="true"
                            placeholder="Selecione um valor"
                            filterBy="firstName"
                            optionValue="id"
                            optionLabel="firstName"
                            [options]="users"
                            [(ngModel)]="data.agentId"
                            (onChange)="clearAgentSelection()"
                        ></p-dropdown>
                        <label>Atendente</label>
                    </span>
                    <span [class]="style.formItem" *ngIf="agentValue == 'supportGroup'" class="p-float-label">
                        <p-dropdown
                            [class]="style.formItem"
                            [filter]="true"
                            placeholder="Selecione um valor"
                            filterBy="name"
                            optionValue="id"
                            optionLabel="name"
                            [options]="supportGroups"
                            [(ngModel)]="data.supportGroupId"
                            (onChange)="clearAgentSelection()"
                        ></p-dropdown>
                        <label>Grupo de Atendimento</label>
                    </span>
                </div>
            </div>
            <div class="col-12 md:col-6 lg:col-9">
                <h5>Descrição</h5>
                <p-editor [(ngModel)]="data.description" [style]="{ height: '21.5rem' }"></p-editor>
            </div>
        </div>
        <p-fieldset legend="Ações" [collapsed]="false" [toggleable]="true">
            <div class="flex flex-row flex-wrap">
                <button pButton icon="pi pi-save" label="Salvar Alterações" class="p-button" onclick="window.history.back(); return false;"></button>
                <button pButton icon="pi pi-check-circle" label="Encerrar" class="p-button-success ml-2" onclick="window.history.back(); return false;"></button>
                <div class="ml-2">
                    <label>Avalie o atendimento de seu chamado!</label>
                    <p-rating [cancel]="false"></p-rating>
                </div>
            </div>
        </p-fieldset>
    </div>
    <div class="card">
        <h5>Novo Apontamento</h5>
        <p-editor [(ngModel)]="data.description" [style]="{ height: '21.5rem' }"></p-editor>
        <button pButton icon="pi pi-save" label="Criar Apontamento" class="p-button mt-3" onclick="window.history.back(); return false;"></button>
    </div>
    <div class="card">
        <h5>Apontamentos</h5>
    </div>
</div>
